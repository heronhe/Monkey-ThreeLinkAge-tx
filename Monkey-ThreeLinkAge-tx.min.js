var MK_ThreeLinkAge=function(){var m,t;function v(t,e){var i=document.createElement("option");return i.innerHTML=t,e&&(i.value=e),i}function e(l){this.proviceElem=l.provice||null,this.cityElem=l.city,this.districtElem=l.district,this.location=l.location,this.key=l.key||"Q4EBZ-K2ORG-OSTQI-IKLRD-NTOXV-7DBVG",this.success=l.success,this.updateCity=l.updateCity,this.updateProvice=l.updateProvice,this.updateDistrict=l.updateDistrict,this.defaultText=l.defaultText||["城市","专柜"],this.addDefaultText=l.addDefaultText,this.counterParam=this.setCounterId(l.data),console.log(this.counterParam),this.coordinateDataOrder=l.coordinateDataOrder,this.timeout=l.timeout||5e3;var u=this;if(this.init(),this.location)if(m)this.getDistance(m);else{t||((t=document.createElement("iframe")).setAttribute("style","display:none"),t.setAttribute("src","https://apis.map.qq.com/tools/geolocation?key="+this.key+"&referer=pmlMap&effect=zoom"),document.body.appendChild(t));var h=0,d=setTimeout(function(){"function"==typeof l.locationError&&l.locationError()},this.timeout);window.addEventListener("message",function t(e){++h;var i=e.data;if((i||1!=h)&&(window.removeEventListener("message",t),d&&clearTimeout(d),e.data||"function"==typeof l.locationError&&l.locationError(),i&&"geolocation"==i.module)){var r={lat:i.lat,lng:i.lng};if(m=r,!u.proviceElem){for(var o=[],n=i.city,a=u.counterParam.AllCounterList,s=0,c=a.length;s<c;s++)a[s].c==n&&o.push(a[s]);0<o.length&&(u.counterParam.AllCounterList=o)}u.getDistance(r),"function"==typeof l.locationSuccess&&l.locationSuccess()}},!1)}this.changeHandler()}return(e.prototype={init:function(){if(this.proviceElem||this.defaultText.splice(0,0,""),this.addDefaultText&&(this.proviceElem&&this.proviceElem.appendChild(v(this.defaultText[0])),this.cityElem.appendChild(v(this.defaultText[1])),this.districtElem&&this.districtElem.appendChild(v(this.defaultText[2]))),this.proviceElem)for(var t=0,e=this.counterParam.PallList.length;t<e;t++)this.proviceElem.appendChild(v(this.counterParam.PallList[t]));else{var i=this.counterParam.ProvinceList.all;for(t=0,e=i.length;t<e;t++)this.cityElem.appendChild(v(i[t]))}},changeHandler:function(){var i=this;this.proviceElem&&this.proviceElem.addEventListener("change",function(){var t=i.proviceElem.value;if(i.cityElem.length=1,i.districtElem&&(i.districtElem.length=1),t!=i.defaultText[0]){for(var e=0;e<i.counterParam.ProvinceList[t].length;e++)i.cityElem.appendChild(v(i.counterParam.ProvinceList[t][e]));"function"==typeof i.updateProvice&&i.updateProvice(i.counterParam.ProvinceList[t])}else"function"==typeof i.updateProvice&&i.updateProvice([])},!1),this.cityElem&&this.cityElem.addEventListener("change",function(){var t=i.cityElem.value;if(i.districtElem&&(i.districtElem.length=1),t!=i.defaultText[1]){if(i.districtElem)for(var e=0;e<i.counterParam.CityList[t].length;e++)i.districtElem.appendChild(v(i.counterParam.CityList[t][e].counterName,i.counterParam.CityList[t][e].id));"function"==typeof i.updateCity&&i.updateCity(i.counterParam.CityList[t])}else"function"==typeof i.updateCity&&i.updateCity([])},!1),this.districtElem&&this.districtElem.addEventListener("change",function(){"function"==typeof i.updateDistrict&&i.updateDistrict()},!1)},getDistance:function(t){var e=this,i=new qq.maps.LatLng(t.lat,t.lng),r=this.counterParam.AllCounterList.length;if(!(r<1)){for(var o=0;o<r;o++){var n,a=e.counterParam.AllCounterList[o].location.split(",");n=1==this.coordinateDataOrder?new qq.maps.LatLng(a[1],a[0]):new qq.maps.LatLng(a[0],a[1]);var s=parseInt(qq.maps.geometry.spherical.computeDistanceBetween(i,n));e.counterParam.AllCounterList[o].distance=s,e.counterIdList[e.counterParam.AllCounterList[o].id].distance=s}this.setDefaultChange()}},setDefaultChange:function(){var t,e,i,r,o=this,n=this.sortStore(this.counterParam.AllCounterList,"distance")[0];for(var a in this.counterParam.CityList)this.counterParam.AllCounterList[a]=this.sortStore(this.counterParam.CityList[a],"distance");if(this.proviceElem){for(var s=0;s<this.proviceElem.options.length;s++)this.location&&this.proviceElem.options[s].value===n.provice&&(this.proviceElem.options[s].selected=!0);"function"==typeof this.updateProvice&&this.updateProvice(this.counterParam.ProvinceList[n.provice])}else n.provice="all";this.cityElem.length=1;for(var c=0;c<this.counterParam.ProvinceList[n.provice].length;c++)t=document.createElement("option"),i=this.counterParam.ProvinceList[n.provice][c],t.innerHTML=i,this.cityElem.appendChild(t),this.location&&i==n.city&&(t.selected=!0);if("function"==typeof o.updateCity&&o.updateCity(o.counterParam.CityList[n.city]),this.districtElem){this.districtElem.length=1;for(var l=0;l<o.counterParam.CityList[n.city].length;l++)e=i,r=o.counterParam.CityList[n.city][l],e.innerHTML=r.counterName,this.districtElem.appendChild(e),o.location&&r.counterName==n.counterName&&(e.selected=!0);"function"==typeof this.updateDistrict&&this.updateDistrict()}"function"==typeof this.success&&this.success({data:!0})},setDefaultCounter:function(t){var e=this;if(!e.location||m){for(var i,r,o,n,a,s=this.counterParam.AllCounterList,c=0,l=s.length;c<l;c++)if(s[c].counterId==t){i=s[c];break}if(this.proviceElem)for(var u=0;u<this.proviceElem.options.length;u++){var h=this.proviceElem.options[u];h.value===i.provice?h.selected=!0:h=!1}else i.provice="all";for(var d=0;d<this.counterParam.ProvinceList[i.provice].length;d++)r=document.createElement("option"),n=this.counterParam.ProvinceList[i.provice][d],r.innerHTML=n,this.cityElem.appendChild(r),n==i.city&&(r.selected=!0);if(this.districtElem){this.districtElem.length=1;for(var p=0;p<e.counterParam.CityList[i.city].length;p++)o=v((a=e.counterParam.CityList[i.city][p]).counterName,t),this.districtElem.appendChild(o),a.counterName==i.counterName&&(o.selected=!0)}}},sortStore:function(t,e){for(var i,r=0,o=t.length-1;r<o;r++)for(var n=0;n<o-r;n++)t[n][e]>t[n+1][e]&&(i=t[n+1],t[n+1]=t[n],t[n]=i);return t},setCounterId:function(t){var e,i,r,o,n=this,a=[],s=[],c={},l={};n.counterIdList={};for(var u=0,h=n.proviceElem?t.length:1;u<h;u++){n.proviceElem?(r=t[u].name,s.push(r),c[r]=[],e=t[u].list):(e=t,c.all=[]);for(var d=0,p=e.length;d<p;d++){var m,v;l[o=e[d].name]=[],n.proviceElem?c[r].push(o):c.all.push(o);for(var f=0,y=(i=e[d].list).length;f<y;f++){var E=i[f];for(var L in v={id:m=E.counterId,city:o},E)v[L]=E[L];r&&(v.provice=r),a.push(v),n.counterIdList[m]=v,l[o].push(v)}}}return{AllCounterList:a,PallList:s,ProvinceList:c,CityList:l}}}).constructor=e}();