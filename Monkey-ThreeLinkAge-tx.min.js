var MK_ThreeLinkAge=(function(){var d,a;function c(e,g){var f=document.createElement("option");f.innerHTML=e;if(g){f.value=g;}return f;}function b(g){this.proviceElem=g.provice||null;
this.cityElem=g.city;this.districtElem=g.district;this.location=g.location;this.key=g.key||"Q4EBZ-K2ORG-OSTQI-IKLRD-NTOXV-7DBVG";this.success=g.success;
this.updateCity=g.updateCity;this.updateProvice=g.updateProvice;this.updateDistrict=g.updateDistrict;this.defaultText=g.defaultText||["城市","专柜"];this.addDefaultText=g.addDefaultText;
this.counterParam=this.setCounterId(g.data);var e=this;this.init();if(this.location){if(d){this.getDistance(d);}else{if(!a){a=document.createElement("iframe");
a.setAttribute("style","display:none");a.setAttribute("src","https://apis.map.qq.com/tools/geolocation?key="+this.key+"&referer=pmlMap&effect=zoom");document.body.appendChild(a);
}var f=function(j){var m=j.data;if(m&&m.module=="geolocation"){var p={lat:m.lat,lng:m.lng};d=p;if(!e.proviceElem){var k=[],h=m.city,i=e.counterParam.AllCounterList;
for(var o=0,l=i.length;o<l;o++){if(i[o].c==h){k.push(i[o]);}}if(k.length>0){e.counterParam.AllCounterList=k;}}e.getDistance(p);window.removeEventListener("message",f);
}};window.addEventListener("message",f,false);}}this.changeHandler();}b.prototype={init:function(){if(!this.proviceElem){this.defaultText.splice(0,0,"");
}if(this.addDefaultText){if(this.proviceElem){this.proviceElem.appendChild(c(this.defaultText[0]));}this.cityElem.appendChild(c(this.defaultText[1]));if(this.districtElem){this.districtElem.appendChild(c(this.defaultText[2]));
}}if(this.proviceElem){for(var e=0,g=this.counterParam.PallList.length;e<g;e++){this.proviceElem.appendChild(c(this.counterParam.PallList[e]));}}else{var f=this.counterParam.ProvinceList.all;
for(var e=0,g=f.length;e<g;e++){this.cityElem.appendChild(c(f[e]));}}},changeHandler:function(){var e=this;if(this.proviceElem){this.proviceElem.addEventListener("change",function(){var f=e.proviceElem.value;
e.cityElem.length=1;if(e.districtElem){e.districtElem.length=1;}if(f==e.defaultText[0]){if(typeof e.updateProvice==="function"){e.updateProvice([]);}return;
}for(var g=0;g<e.counterParam.ProvinceList[f].length;g++){e.cityElem.appendChild(c(e.counterParam.ProvinceList[f][g]));}if(typeof e.updateProvice==="function"){e.updateProvice(e.counterParam.ProvinceList[f]);
}},false);}if(this.cityElem){this.cityElem.addEventListener("change",function(){var g=e.cityElem.value;if(e.districtElem){e.districtElem.length=1;}if(g==e.defaultText[1]){if(typeof e.updateCity==="function"){e.updateCity([]);
}return;}if(e.districtElem){for(var f=0;f<e.counterParam.CityList[g].length;f++){e.districtElem.appendChild(c(e.counterParam.CityList[g][f].counterName,e.counterParam.CityList[g][f].id));
}}if(typeof e.updateCity==="function"){e.updateCity(e.counterParam.CityList[g]);}},false);}if(this.districtElem){this.districtElem.addEventListener("change",function(){if(typeof e.updateDistrict==="function"){e.updateDistrict();
}},false);}},getDistance:function(l){var h=this;var g=new qq.maps.LatLng(l.lat,l.lng),k=this.counterParam.AllCounterList.length;if(k<1){return;}for(var j=0;
j<k;j++){var f=h.counterParam.AllCounterList[j].location.split(",");var e=new qq.maps.LatLng(f[1],f[0]);var m=parseInt(qq.maps.geometry.spherical.computeDistanceBetween(g,e));
h.counterParam.AllCounterList[j].distance=m;h.counterIdList[h.counterParam.AllCounterList[j].id].distance=m;}this.setDefaultChange();},setDefaultChange:function(){var r=this;
var q=this.sortStore(this.counterParam.AllCounterList,"distance");var g=q[0];for(var e in this.counterParam.CityList){this.counterParam.AllCounterList[e]=this.sortStore(this.counterParam.CityList[e],"distance");
}var o,n;if(this.proviceElem){for(var l=0;l<this.proviceElem.options.length;l++){if(this.location){if(this.proviceElem.options[l].value===g.provice){this.proviceElem.options[l].selected=true;
}}}if(typeof this.updateProvice==="function"){this.updateProvice(this.counterParam.ProvinceList[g.provice]);}}else{g.provice="all";}var m;this.cityElem.length=1;
for(var h=0;h<this.counterParam.ProvinceList[g.provice].length;h++){o=document.createElement("option");m=this.counterParam.ProvinceList[g.provice][h];o.innerHTML=m;
this.cityElem.appendChild(o);if(this.location){if(m==g.city){o.selected=true;}}}if(typeof r.updateCity==="function"){r.updateCity(r.counterParam.CityList[g.city]);
}var p;if(this.districtElem){this.districtElem.length=1;for(var f=0;f<r.counterParam.CityList[g.city].length;f++){n=document.createElement("option");p=r.counterParam.CityList[g.city][f];
n.innerHTML=p.counterName;this.districtElem.appendChild(n);if(r.location){if(p.counterName==g.counterName){n.selected=true;}}}if(typeof this.updateDistrict==="function"){this.updateDistrict();
}}if(typeof this.success==="function"){this.success({data:true});}},sortStore:function(g,h){var l;for(var f=0,k=g.length-1;f<k;f++){for(var e=0;e<k-f;e++){if(g[e][h]>g[e+1][h]){l=g[e+1];
g[e+1]=g[e];g[e]=l;}}}return g;},setCounterId:function(x){var q=this,m=[],f=[],s={},h={},g,e,w,k;q.counterIdList={};for(var u=0,l=q.proviceElem?x.length:1;
u<l;u++){if(q.proviceElem){w=x[u].name;f.push(w);s[w]=[];g=x[u].list;}else{g=x;s.all=[];}for(var t=0,p=g.length;t<p;t++){k=g[t].name;h[k]=[];if(q.proviceElem){s[w].push(k);
}else{s.all.push(k);}e=g[t].list;var v,y;for(var r=0,o=e.length;r<o;r++){v=e[r].counterId;y={id:v,city:k,counterName:e[r].counterName,location:e[r].location,address:e[r].address||""};
if(w){y.provice=w;}m.push(y);q.counterIdList[v]=y;h[k].push(y);}}}return{AllCounterList:m,PallList:f,ProvinceList:s,CityList:h};}};b.prototype.constructor=b;
return b;})();