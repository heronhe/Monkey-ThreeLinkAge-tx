var MK_ThreeLinkAge=function(){var u,e;function r(t,e){var i=document.createElement("option");return i.innerHTML=t,e&&(i.value=e),i}function t(t){this.proviceElem=t.provice||null,this.cityElem=t.city,this.districtElem=t.district,this.location=t.location,this.key=t.key||"Q4EBZ-K2ORG-OSTQI-IKLRD-NTOXV-7DBVG",this.success=t.success,this.updateCity=t.updateCity,this.updateProvice=t.updateProvice,this.updateDistrict=t.updateDistrict,this.defaultText=t.defaultText||["城市","专柜"],this.addDefaultText=t.addDefaultText,this.counterParam=this.setCounterId(t.data),this.coordinateDataOrder=t.coordinateDataOrder;var c=this;if(this.init(),this.location)if(u)this.getDistance(u);else{e||((e=document.createElement("iframe")).setAttribute("style","display:none"),e.setAttribute("src","https://apis.map.qq.com/tools/geolocation?key="+this.key+"&referer=pmlMap&effect=zoom"),document.body.appendChild(e));var l=function(t){var e=t.data;if(e&&"geolocation"==e.module){var i={lat:e.lat,lng:e.lng};if(u=i,!c.proviceElem){for(var r=[],a=e.city,n=c.counterParam.AllCounterList,s=0,o=n.length;s<o;s++)n[s].c==a&&r.push(n[s]);0<r.length&&(c.counterParam.AllCounterList=r)}c.getDistance(i),window.removeEventListener("message",l)}};window.addEventListener("message",l,!1)}this.changeHandler()}return(t.prototype={init:function(){if(this.proviceElem||this.defaultText.splice(0,0,""),this.addDefaultText&&(this.proviceElem&&this.proviceElem.appendChild(r(this.defaultText[0])),this.cityElem.appendChild(r(this.defaultText[1])),this.districtElem&&this.districtElem.appendChild(r(this.defaultText[2]))),this.proviceElem)for(var t=0,e=this.counterParam.PallList.length;t<e;t++)this.proviceElem.appendChild(r(this.counterParam.PallList[t]));else{var i=this.counterParam.ProvinceList.all;for(t=0,e=i.length;t<e;t++)this.cityElem.appendChild(r(i[t]))}},changeHandler:function(){var i=this;this.proviceElem&&this.proviceElem.addEventListener("change",function(){var t=i.proviceElem.value;if(i.cityElem.length=1,i.districtElem&&(i.districtElem.length=1),t!=i.defaultText[0]){for(var e=0;e<i.counterParam.ProvinceList[t].length;e++)i.cityElem.appendChild(r(i.counterParam.ProvinceList[t][e]));"function"==typeof i.updateProvice&&i.updateProvice(i.counterParam.ProvinceList[t])}else"function"==typeof i.updateProvice&&i.updateProvice([])},!1),this.cityElem&&this.cityElem.addEventListener("change",function(){var t=i.cityElem.value;if(i.districtElem&&(i.districtElem.length=1),t!=i.defaultText[1]){if(i.districtElem)for(var e=0;e<i.counterParam.CityList[t].length;e++)i.districtElem.appendChild(r(i.counterParam.CityList[t][e].counterName,i.counterParam.CityList[t][e].id));"function"==typeof i.updateCity&&i.updateCity(i.counterParam.CityList[t])}else"function"==typeof i.updateCity&&i.updateCity([])},!1),this.districtElem&&this.districtElem.addEventListener("change",function(){"function"==typeof i.updateDistrict&&i.updateDistrict()},!1)},getDistance:function(t){var e=this,i=new qq.maps.LatLng(t.lat,t.lng),r=this.counterParam.AllCounterList.length;if(!(r<1)){for(var a=0;a<r;a++){var n,s=e.counterParam.AllCounterList[a].location.split(",");n=1==this.coordinateDataOrder?new qq.maps.LatLng(s[1],s[0]):new qq.maps.LatLng(s[0],s[1]);var o=parseInt(qq.maps.geometry.spherical.computeDistanceBetween(i,n));e.counterParam.AllCounterList[a].distance=o,e.counterIdList[e.counterParam.AllCounterList[a].id].distance=o}this.setDefaultChange()}},setDefaultChange:function(){var t,e,i,r,a=this,n=this.sortStore(this.counterParam.AllCounterList,"distance")[0];for(var s in this.counterParam.CityList)this.counterParam.AllCounterList[s]=this.sortStore(this.counterParam.CityList[s],"distance");if(this.proviceElem){for(var o=0;o<this.proviceElem.options.length;o++)this.location&&this.proviceElem.options[o].value===n.provice&&(this.proviceElem.options[o].selected=!0);"function"==typeof this.updateProvice&&this.updateProvice(this.counterParam.ProvinceList[n.provice])}else n.provice="all";this.cityElem.length=1;for(var c=0;c<this.counterParam.ProvinceList[n.provice].length;c++)t=document.createElement("option"),i=this.counterParam.ProvinceList[n.provice][c],t.innerHTML=i,this.cityElem.appendChild(t),this.location&&i==n.city&&(t.selected=!0);if("function"==typeof a.updateCity&&a.updateCity(a.counterParam.CityList[n.city]),this.districtElem){this.districtElem.length=1;for(var l=0;l<a.counterParam.CityList[n.city].length;l++)e=document.createElement("option"),r=a.counterParam.CityList[n.city][l],e.innerHTML=r.counterName,this.districtElem.appendChild(e),a.location&&r.counterName==n.counterName&&(e.selected=!0);"function"==typeof this.updateDistrict&&this.updateDistrict()}"function"==typeof this.success&&this.success({data:!0})},sortStore:function(t,e){for(var i,r=0,a=t.length-1;r<a;r++)for(var n=0;n<a-r;n++)t[n][e]>t[n+1][e]&&(i=t[n+1],t[n+1]=t[n],t[n]=i);return t},setCounterId:function(t){var e,i,r,a,n=this,s=[],o=[],c={},l={};n.counterIdList={};for(var u=0,h=n.proviceElem?t.length:1;u<h;u++){n.proviceElem?(r=t[u].name,o.push(r),c[r]=[],e=t[u].list):(e=t,c.all=[]);for(var d=0,p=e.length;d<p;d++){var m,v;l[a=e[d].name]=[],n.proviceElem?c[r].push(a):c.all.push(a);for(var f=0,y=(i=e[d].list).length;f<y;f++){var E=i[f];for(var L in v={id:m=E.counterId,city:a},E)v[L]=E[L];r&&(v.provice=r),s.push(v),n.counterIdList[m]=v,l[a].push(v)}}}return{AllCounterList:s,PallList:o,ProvinceList:c,CityList:l}}}).constructor=t}();